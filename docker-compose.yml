# Production Docker Compose Configuration
# Usage: docker-compose up -d
services:
  amlink-mcp-server:
    build:
      context: ./src/amlink-submissions-mcp-server
      dockerfile: Dockerfile
    container_name: amlink-mcp-server
    ports:
      - "8080:80"
      - "8443:443"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_Kestrel__Certificates__Default__Password=YourSecurePassword123!
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/https/aspnetapp.pfx
      - ASPNETCORE_URLS=http://+:80;https://+:443
      - ExternalApis__SubmissionApi__BaseUrl=https://amlink-submission-api-dev.amwins.net/v1/
      - ExternalApis__SubmissionApi__RequiredScope=amlink-submission-api
      - ExternalApis__SubmissionApi__UserAgent=mcp-submission-client
      - ExternalApis__SubmissionApi__Version=1.0
      - IdentityServer__ClientId=al-mcp-client
      - IdentityServer__ClientSecret=${IDENTITY_SERVER_CLIENT_SECRET:?IDENTITY_SERVER_CLIENT_SECRET is required}
      - IdentityServer__GrantType=authorization_code
      - IdentityServer__Scopes=amlink-maintenance-api amlink-submission-api amlink-policy-api amlink-doc-api amwins-graphadapter-api
      - IdentityServer__Url=https://identitydev.amwins.com
      - OPENAI_API_KEY=${OPENAI_API_KEY:?OPENAI_API_KEY is required}
      - Server__Url=http://amlink-mcp-server:80
    volumes:
      - dataprotection-keys:/root/.aspnet/DataProtection-Keys
      - ~/.aspnet/https:/https:ro
    restart: unless-stopped
    networks:
      - amlink-network

  amlink-mcp-client:
    build:
      context: ./src/amlink-submissions-mcp-client
      dockerfile: Dockerfile
    container_name: amlink-mcp-client
    ports:
      - "5000:80"
      - "5001:443"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_Kestrel__Certificates__Default__Password=YourSecurePassword123!
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/https/aspnetapp.pfx
      - ASPNETCORE_URLS=http://+:80;https://+:443
      - IdentityServer__ClientId=al-mcp-client
      - IdentityServer__ClientSecret=${IDENTITY_SERVER_CLIENT_SECRET:?IDENTITY_SERVER_CLIENT_SECRET is required}
      - IdentityServer__GrantType=authorization_code
      - IdentityServer__RedirectUri=https://localhost:5001/oauth/callback
      - IdentityServer__ResponseMode=query
      - IdentityServer__Scopes=amlink-maintenance-api amlink-submission-api amlink-policy-api amlink-doc-api amwins-graphadapter-api
      - IdentityServer__ServerClientId=al-mcp-client
      - IdentityServer__Url=https://identitydev.amwins.com
      - McpServer__BrowserUrl=https://localhost:8443
      - McpServer__Url=http://amlink-mcp-server:80
      - OPENAI_API_KEY=${OPENAI_API_KEY:?OPENAI_API_KEY is required}
    volumes:
      - dataprotection-keys:/root/.aspnet/DataProtection-Keys
      - ~/.aspnet/https:/https:ro
    depends_on:
      - amlink-mcp-server
    restart: unless-stopped
    networks:
      - amlink-network

networks:
  amlink-network:
    driver: bridge

volumes:
  dataprotection-keys: